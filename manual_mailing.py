import asyncio
import sys
import os

sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from config import BOT_TOKEN
from services.mailing import broadcast_message
from aiogram import Bot


async def main():
    bot = Bot(token=BOT_TOKEN)

    # –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
    image_url = "https://example.com/new-course.jpg"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
    text = """üî• <b>–ù–æ–≤—ã–π –∫—É—Ä—Å –ø–æ Machine Learning!</b>

–û—Å–≤–æ–π—Ç–µ –æ–¥–Ω—É –∏–∑ —Å–∞–º—ã—Ö –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π 2024 –≥–æ–¥–∞!

üéØ –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
‚Ä¢ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ ML
‚Ä¢ –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫—É –º–µ–Ω—Ç–æ—Ä–∞
‚Ä¢ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

–ù–µ —É–ø—É—Å—Ç–∏—Ç–µ —à–∞–Ω—Å —Å—Ç–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º –≤ –æ–±–ª–∞—Å—Ç–∏ –ò–ò!"""

    button_url = "https://example.com/ml-course"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É

    success_count = await broadcast_message(bot, image_url, text, button_url, "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫—É—Ä—Å")
    print(f"–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ {success_count} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º")

    await bot.session.close()


if __name__ == '__main__':
    asyncio.run(main())